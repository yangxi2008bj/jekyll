---
layout: post
title: "CentOS6.9搭建Dubbo教程"
date: 2017-11-20
description: "Dubbo搭建教程"
tag: Java
---   
##### Dubbo简介

- Flyway是什么？

	Flyway是独立于数据库的应用、管理并跟踪数据库变更的数据库版本管理工具。Arun Gupta, Director of Developer Advocacy, Red Hat 曾说Flyway应该是所有Java企业应用开发的一个基础部分，它让数据库迁移无缝整合在整个应用生命周期。

- 为什么要用Flyway？

	Flyway的官网是如此介绍的：
	
	如果有一个软件叫Shiny Soft，以及它对应的数据库Shiny DB。简单的呈现如下图  

	![](/blogImages/flywayshinny.jpg)

	但是在大多数项目中，它应该如下图
	
	![](/blogImages/flywaySchema.jpg)	

	这样一来，我们就不仅要处理一个环境的备份，而是好几个。这样就会带来一系列问题
	代码版本进行很好的控制和定义，而数据库呢？ 产品在一个环境不停的迭代，而在另一个环境数据库的版本应该是哪个版本呢？目前大多数项目还是依赖人工执行sql脚本。
	
	![](/blogImages/flywayshinnyDB.jpg)

	所以数据库迁移其实重点是对数据库版本进行控制，此时Flyway应运而生。

- Flyway工作原理

	最简单的场景是当你的Flyway指向一个空数据库
	
	![](/blogImages/EmptyDb.jpg)

	1. Flyway会去检查数据库中的Flyway的基础表，如果当你的数据库是空数据库是，Flyway将创建它的基础表。
	2. 这时数据库就有了一个叫`SCHEMA_VERSION`的空表，这张表会用于跟踪数据库的状态。
	3. Flyway会扫描项目中的sql文件，根据版本号排序，依次执行sql语句。
	4. 如果已有基础表，Flyway会根据已有的`SCHEMA_VERSION`中的版本号，对此版本号之后的脚本进行升级。

	![](/blogImages/Migration-1-2.jpg)

##### 安装JDK

- 卸载OpenJDK环境，使用以下命令查看已有的OpenJDK

	```bash
	rpm -qa | grep java    
	rpm -qa | grep jdk   
	```

	使用以下代码批量删除名字包含jdk的已安装的程序
	```bash
	rpm -qa | grep jdk | xargs rpm -e --nodeps   
	```

 - 安装JDK 1.8
	 1. 下载获取JDK: wget --no-check-certificate --no-cookie --header "Cookie: oraclelicense=accept-securebackup-cookie;" http://download.oracle.com/otn-pub/java/jdk/8u151-b12/e758a0de34e24606bca991d704f6dcbf/jdk-8u151-linux-x64.tar.gz

	 2. 解压下载包，tar -zxvf jdk-8u131-linux-x64.tar.gz

	 3. 设置环境变量：

	 添加至 /etc/profile 
	 source /etc/profile 使设置生效  

	```bash 
	JAVA_HOME=/usr/java/jdk1.8
	JRE_HOME=/usr/java/jdk1.8/jre  
	PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin  
	CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib  
	export JAVA_HOME  
	export PATH  
	export CLASSPATH
	```

##### 安装Zookeeper

- 下载获取Zookeeper安装文件： wget http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.11/zookeeper-3.4.11.tar.gz

- 解压 tar -zxvf zookeeper-3.4.11.tar.gz

- 在zookeeper-3.4.11中的conf文件中创建zoo.cfg

	```bash
	# The number of milliseconds of each tick
	tickTime=2000
	# The number of ticks that the initial
	# synchronization phase can take
	initLimit=10
	# The number of ticks that can pass between
	# sending a request and getting an acknowledgement
	syncLimit=5
	# the directory where the snapshot is stored.
	# do not use /tmp for storage, /tmp here is just
	# example sakes.
	dataDir=/tmp/zookeeper
	# the port at which the clients will connect
	clientPort=2181
	# the maximum number of client connections.
	# increase this if you need to handle more clients
	#maxClientCnxns=60
	#
	# Be sure to read the maintenance section of the
	# administrator guide before turning on autopurge.
	#
	# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance
	#
	# The number of snapshots to retain in dataDir
	#autopurge.snapRetainCount=3
	# Purge task interval in hours
	# Set to "0" to disable auto purge feature
	#autopurge.purgeInterval=1
	```

- 在zookeeper-3.4.11中的bin文件下执行命令开启zookeeper服务： ./zkServer.sh start 

##### 安装Tomcat 7

- 下载Tomcat 7： wget http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-7/v7.0.82/bin/apache-tomcat-7.0.82.tar.gz

- 解压：tar -zxvf apache-tomcat-7.0.82.tar.gz

- 在apache-tomcat-7.0.82下bin文件中，启动 ./startup.sh

##### 安装Dubbo

- 下载Dubbo地址：http://download.csdn.net/download/z280298909/10014125

- 删除tomcat, webapp下所有文件及文件夹

- 将下载的war包部署在webapp下

- 如有多个tomcat，请增加以下内容至 /etc/profile

	```bash
	CATALINA_3_BASE=/usr/local/tomcat_dubbo
	CATALINA_3_HOME=/usr/local/tomcat_dubbo
	TOMCAT_3_HOME=/usr/local/tomcat_dubbo
	export CATALINA_3_BASE CATALINA_3_HOME TOMCAT_3_HOME
	```
- 如有多个tomcat，请在tomcat bin下的catalina.sh中 #OS specific support. 后增加跟上一步增加的环境变量对应：
	```bash
	export CATALINA_BASE=$CATALINA_3_BASE
	export CATALINA_HOME=$CATALINA_3_HOME
	```

- 如有多个tomcat，请注意在tomcat conf下server.xml中修改三个端口，以防止端口冲突

##### 登录Dubbo

- 根据服务器地址和tomcat设置的端口加上/admin 登录Dubbo 初始用户名为root 密码为root （10.10.10.1:8080/admin）

- 直接使用服务器和端口访问Dubbo (10.10.10.1:8080)


 