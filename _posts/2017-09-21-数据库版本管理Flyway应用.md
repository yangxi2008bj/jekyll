---
layout: post
title: "Eclipse加入SonarLint代码审查"
date: 2017-09-21
description: "Flyway"
tag: Java
---   
## Flyway简介

- Flyway是什么？

	Flyway是独立于数据库的应用、管理并跟踪数据库变更的数据库版本管理工具。Arun Gupta, Director of Developer Advocacy, Red Hat 曾说Flyway应该是所有Java企业应用开发的一个基础部分，它让数据库迁移无缝整合在整个应用生命周期。

- 为什么要用Flyway？

	Flyway的官网是如此介绍的：
	
	如果有一个软件叫Shiny Soft，以及它对应的数据库Shiny DB。简单的呈现如下图  

	![](/blogImages/flywayshinny.jpg)

	但是在大多数项目中，它应该如下图
	
	![](/blogImages/flywaySchema.jpg)	

	这样一来，我们就不仅要处理一个环境的备份，而是好几个。这样就会带来一系列问题
	代码版本进行很好的控制和定义，而数据库呢？ 产品在一个环境不停的迭代，而在另一个环境数据库的版本应该是哪个版本呢？目前大多数项目还是依赖人工执行sql脚本。
	
	![](/blogImages/flywayshinnyDB.jpg)

	所以数据库迁移其实重点是对数据库版本进行控制，此时Flyway应运而生。

- Flyway工作原理

	最简单的场景是当你的Flyway指向一个空数据库
	
	![](/blogImages/EmptyDb.jpg)

	1. Flyway会去检查数据库中的Flyway的基础表，如果当你的数据库是空数据库是，Flyway将创建它的基础表。
	2. 这时数据库就有了一个叫`SCHEMA_VERSION`的空表，这张表会用于跟踪数据库的状态。
	3. Flyway会扫描项目中的sql文件，根据版本号排序，依次执行sql语句。
	4. 如果已有基础表，Flyway会根据已有的`SCHEMA_VERSION`中的版本号，对此版本号之后的脚本进行升级。

	![](/blogImages/Migration-1-2.jpg)

## SpringMVC+Maven如何整合Flyway
